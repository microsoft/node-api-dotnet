<Project>
  <!-- Clean the local cache when building a package so local projects always get the new content. -->
  <Target Name="CleanLocalPackageCache"
    AfterTargets="Pack"
    Condition=" '$(PackageId)' != '' AND '$(PackageOutputPath)' != '' "
  >
    <RemoveDir Directories="$(PackageOutputPath)$(PackageId)" />
  </Target>

  <!--
  Write the NuGet package version to a props file so it can be consumed by test and example projects
  to reference the locally-built package version. The NuGet package version is generated by
  Nerdbank.GitVersioning and includes a git commit hash when on a non-main branch.
  -->
  <Target Name="WriteVersionProps"
    BeforeTargets="Pack"
  >
    <PropertyGroup>
      <LibNodePackageVersion Condition="'%(PackageVersion.Identity)' == 'Microsoft.JavaScript.LibNode'">%(PackageVersion.Version)</LibNodePackageVersion>
    </PropertyGroup>
    <WriteLinesToFile
      File="$(PackageOutputPath)version.props"
      Overwrite="true"
      WriteOnlyWhenDifferent="true"
      Lines="
        &lt;Project&gt;;
        %20%20&lt;PropertyGroup&gt;;
        %20%20%20%20&lt;LibNodePackageVersion&gt;$(LibNodePackageVersion)&lt;/LibNodePackageVersion&gt;;
        %20%20%20%20&lt;NodeApiDotNetPackageVersion&gt;$(NuGetPackageVersion)&lt;/NodeApiDotNetPackageVersion&gt;;
        %20%20&lt;/PropertyGroup&gt;;
        &lt;/Project&gt;"
    />
  </Target>
</Project>
